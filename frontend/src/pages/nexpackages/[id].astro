---
export async function getStaticPaths() {
	const registryUrl = 'https://nex-9ujp.onrender.com/api/packages';
	let packages: Array<{ id: string }> = [];

	try {
		if (import.meta.env.DEV) {
			packages = [
				{
					id: 'devkiraa.pagepull'
				}
			];
		} else {
			const response = await fetch(registryUrl);
			const data = await response.json();
			const fetched = (data.packages || []) as Array<{ id: string }>;
			packages = fetched.map((pkg) => ({ id: pkg.id }));
		}
	} catch (e) {
		packages = [];
	}

	return packages.map((pkg) => ({
		params: { id: pkg.id },
		props: { id: pkg.id }
	}));
}

const { id } = Astro.props as { id: string };
const base = import.meta.env.BASE_URL;
return Astro.redirect(`${base}packages/${id}`);
---
